Inference for camera trap data using `camtrap`.
================
James Henderson
3/4/2017

Introduction
------------

The R package `camtrap` is built on and extends the capabilities of the `overlap` package for analyzing time-of-day data such as that generated by camera traps. The primary extensions are:
- modified functions allowing attention to be focused on specific time windows,
- the addition of estimates for the area between densities rather than the overlap alone,
- the addition of "permutation" tests for hypothesis testing.

The following sections are meant to illustrate the use of the added functionality. This documentation and package are both in the early stages of development and not intended for use outside of current collaborators.

Quick Start
-----------

In this section we briefly describe how to get up and running with this package. This is a development version of the package available on git hub. For easy installation, first install and load the `devtools` package.

``` r
#install.packages('devtools')
library(devtools)
```

You can then install the most recent version of `camtrap` directly from GitHub as indicated in the comments below.

``` r
#install.packages('overlap')
#install_git('git://github.com/jbhender/camtrap/')
library(camtrap)
```

    ## Loading required package: overlap

The `overlap` package is loaded automatically and must be installed prior to installing `camtrap`. The examples in the following section will make use of data from `overlap`.

``` r
data(simulatedData)
head(tigerObs); head(pigObs)
```

    ## [1] 1.621475 1.699564 4.417767 4.616995 4.629183 4.942589

    ## [1] 3.581162 3.615083 3.428990 4.093152 3.171928 3.534832

Overlap and Excess for a Fixed Window
-------------------------------------

The overlap package takes two vectors of observation times in radians, fits densities to each vector, and then estimates the overlap defined as the area under the minimum of the two density functions:

overlap = ∫<sub>*t*<sub>0</sub></sub><sup>*t*<sub>1</sub></sup>*f*<sub>1</sub>(*s*)∧*f*<sub>2</sub>(*s*)*d**s*.

``` r
overlapPlot(tigerObs,pigObs)
```

![](vignette_files/figure-markdown_github/unnamed-chunk-2-1.png)

``` r
overlapEst(tigerObs,pigObs)
```

    ##     Dhat1     Dhat4     Dhat5 
    ## 0.2908618 0.2692011 0.2275000

To focus on a specific time interval use the 'window' versions of these functions provided in this package. The time interval of interest is specified using `t0` and `t1`. For `overlapEstWindow` these endpoints should be given on a 24 hour scale; the scale for `overlapPlotWindow` can be specified using the `xscale` option.

``` r
overlapPlotWindow(tigerObs,pigObs,t0=0,t1=24)
```

![](vignette_files/figure-markdown_github/unnamed-chunk-3-1.png)

``` r
overlapEstWindow(tigerObs,pigObs,t0=0,t1=24)
```

    ## $overlap
    ## [1] 0.2908729
    ## 
    ## $excess
    ## [1] -1.206257e-12
    ## 
    ## $window
    ## [1] 0.000000 6.283185

The plotting function should include the same options as for `overlapPlot`, with the exception of providing a 'rug' plot which remains to be implemented.

Comparing the output of `overlapEst` and `overlapEstWindow` you can see that the overlap estimate most closely resembles "Dhat1". Both estimates directly use the area under the fitted density curves, but the version in this package uses adaptive quadrature (i.e. `integrate`) in place of a fixed grid.

### Understanding the excess

In addition to estimating the overlap for a fixed user-provided window, the `camptrap` package also estimates the "excess" defined here to mean the area between the density curves:
*E*<sub>*n**e**t*</sub>(*t*<sub>0</sub>, *t*<sub>1</sub>)=∫<sub>*t*<sub>0</sub></sub><sup>*t*<sub>1</sub></sup>*f*<sub>1</sub>(*s*)−*f*<sub>2</sub>(*s*)*d**s*.
 The `type` option can be used in `overlapPlotWindow` to display the excess in place of the overlap.

``` r
overlapPlotWindow(tigerObs,pigObs,t0=16,t1=21,type='excess')
```

![](vignette_files/figure-markdown_github/unnamed-chunk-4-1.png)

``` r
overlapEstWindow(tigerObs,pigObs,t0=16,t1=21)
```

    ## $overlap
    ## [1] 0.1253551
    ## 
    ## $excess
    ## [1] 0.2961325
    ## 
    ## $window
    ## [1] 4.188790 5.497787

Examining the output above, we can say that the difference in the proportions of tiger and pig activity between 16:00 and 21:00 is nearly 30%. As currently computed, the excess gives the *net* difference between the curves. We should consider alternate treatments of this such as:

*E*<sub>*m**a**x*</sub>(*t*<sub>0</sub>, *t*<sub>1</sub>)=∫<sub>*t*<sub>0</sub></sub><sup>*t*<sub>1</sub></sup>(*f*<sub>1</sub>(*s*)−*f*<sub>2</sub>(*s*))<sub>+</sub>*d**s*  ∨  ∫<sub>*t*<sub>0</sub></sub><sup>*t*<sub>1</sub></sup>(*f*<sub>2</sub>(*s*)−*f*<sub>1</sub>(*s*))<sub>+</sub>*d**s*,
 where ( ⋅ )<sub>+</sub> = min(⋅, 0).

Finding the points of intersection
----------------------------------

The function `overlapCross` can be used to find the points at which two density curves cross. We will illustrate using the Kerinci data from the `overlap` package.

``` r
data('kerinci')
head(kerinci)
```

    ##   Zone   Sps  Time
    ## 1    1 tiger 0.175
    ## 2    1 tiger 0.787
    ## 3    1 tiger 0.247
    ## 4    1 tiger 0.591
    ## 5    1 tiger 0.500
    ## 6    1 tiger 0.564

``` r
with(kerinci,table(Sps,Zone))
```

    ##          Zone
    ## Sps         1   2   3   4
    ##   boar      0   7   6  15
    ##   clouded  27  10  17  32
    ##   golden   14  26  38  26
    ##   macaque  23 125  59  66
    ##   muntjac  11  99  61  29
    ##   sambar    1  14   5   5
    ##   tapir    13  61  42  65
    ##   tiger    15  83  52  51

Note that the times there are given in \[0,1\], so we will multiply by 2*π* to scale to radians. The function will find all crossings, provided the minimal time between crossings is longer 1/`n.grid`.

``` r
macaque3 <- with(kerinci,Time[which(Sps=='macaque' & Zone==3)])*2*pi
macaque4 <- with(kerinci,Time[which(Sps=='macaque' & Zone==4)])*2*pi
crossings <- overlapCross(macaque3,macaque4,scale24=T)
crossings
```

    ## [1]  2.867589  4.229762  7.439836 12.658345 19.030563 20.842055

We can extract the crossings between 6am and 6pm as shown below.

``` r
tt <- crossings[which(crossings > 6 & crossings < 18)]
overlapPlotWindow(macaque3,macaque4,xcenter='noon',tt[1],tt[2])
```

![](vignette_files/figure-markdown_github/overlap%20window-1.png)

Inference using Permutation Tests
---------------------------------

Based on these images, tigers and pigs clearly follow different patterns of activity. However, in other cases such as when comparing the same species from different regions we may wish to assess the significance of an observed difference relative to a specific null hypothesis. For example, when making intra-species comparisons, one may wish to assess whether observed differences provide evidence for real differences in activity patterns or can be attributed to the noise from finite sample sizes.

This can be done using the `overlapPerm` function, which tests against the null hypothesis that the densities generating the two observation vectors are equal during the requested time interval.

To illustrate the functionality, consider again the macaques from zones 3 and 4 in the Kerinci data. Let's focus on the daytime hours between 5am and 7pm.

``` r
overlapPlotWindow(macaque3,macaque4,5,19)
```

![](vignette_files/figure-markdown_github/overlapPlot%20macaques-1.png)

``` r
perm <- overlapPerm(macaque3,macaque4,t0=5,t1=19,nperm=1000)
print(perm)
```

    ##            observed reference p-value
    ## overlap       0.733     0.951   0.035
    ## net excess    0.035     0.000   0.378
    ## Parametric permutation tests for difference from refrence.
    ## For the excess the test is two-sided.

Focusing on the overlap row, the output from the permutation tests tells us that the observed overlap during the requested window was 73%. Compare this to the reference value of 95% which is an estimate of the maximum overlap for the requested window. The reference value will always be one when considering the full day. The p-value tells us that from 1000 simulations, only 3.5% had an overlap smaller than the actually observed overlap suggesting the observed differences are not purely attributable to chance.

In contrast, the net excess during this window is not significantly different from zero. This make sense given that our window includes the bulk of the activity for both sets of macaques since densities always integrate to one.

We can compare our result based on the overlap, to a Kolmogorov-Smirnoff test comparing two distributions.

``` r
ks.test(macaque3,macaque4)
```

    ## Warning in ks.test(macaque3, macaque4): cannot compute exact p-value with
    ## ties

    ## 
    ##  Two-sample Kolmogorov-Smirnov test
    ## 
    ## data:  macaque3 and macaque4
    ## D = 0.2057, p-value = 0.1432
    ## alternative hypothesis: two-sided

``` r
perm <- overlapPerm(macaque3,macaque4,t0=0,t1=24,nperm=1000)
print(perm)
```

    ##            observed reference p-value
    ## overlap       0.754         1   0.026
    ## net excess    0.000         0   0.428
    ## Parametric permutation tests for difference from refrence.
    ## For the excess the test is two-sided.

This suggests the permutation test may be more powerful, though additional study is needed to ensure we are correctly controlling the type 1 error.
